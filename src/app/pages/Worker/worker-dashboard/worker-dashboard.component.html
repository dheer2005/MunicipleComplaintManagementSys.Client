<div class="container-fluid py-4">
    <!-- Welcome Banner -->
    <div class="welcome-banner" *ngIf="!loading">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h2 class="mb-2">Welcome back, {{ workerName }}!</h2>
                <p class="mb-0">Here's your task overview for today. Keep up the great work!</p>
            </div>
            <div class="col-md-4 text-end">
                <button class="btn btn-light action-btn" (click)="refreshDashboard()">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <!-- <div *ngIf="loading" class="text-center py-5">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-3">Loading your dashboard...</p>
    </div> -->

    <div *ngIf="!loading">
        <!-- Statistics Cards -->
        <div class="row mb-4">
            <div class="col-md-2 col-sm-6 mb-3">
                <div class="card dashboard-card stat-card">
                    <div class="card-body text-center">
                        <i class="fas fa-tasks fa-3x mb-3"></i>
                        <h3 class="mb-1">{{ stats.totalAssigned }}</h3>
                        <p class="mb-0">Total Assigned</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-2 col-sm-6 mb-3">
                <div class="card dashboard-card stat-card pending">
                    <div class="card-body text-center">
                        <i class="fas fa-clock fa-3x mb-3"></i>
                        <h3 class="mb-1">{{ stats.pending }}</h3>
                        <p class="mb-0">Pending</p>
                    </div>
                </div>
            </div>
            <div class="col-md-2 col-sm-6 mb-3">
                <div class="card dashboard-card stat-card inProgress">
                    <div class="card-body text-center">
                        <i class="fas fa-spinner fa-3x mb-3"></i>
                        <h3 class="mb-1">{{ stats.inProgress }}</h3>
                        <p class="mb-0">InProgress</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-2 col-sm-6 mb-3">
                <div class="card dashboard-card stat-card resolved">
                    <div class="card-body text-center">
                        <i class="fas fa-check-circle fa-3x mb-3"></i>
                        <h3 class="mb-1">{{ stats.resolved }}</h3>
                        <p class="mb-0">Resolved</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-2 col-sm-6 mb-3">
                <div class="card dashboard-card stat-card overdue">
                    <div class="card-body text-center">
                        <i class="fas fa-exclamation-triangle fa-3x mb-3"></i>
                        <h3 class="mb-1">{{ stats.overdue }}</h3>
                        <p class="mb-0">Overdue</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-2 col-sm-6 mb-3">
                <div class="card dashboard-card stat-card">
                    <div class="card-body text-center">
                        <i class="fas fa-percentage fa-3x mb-3"></i>
                        <h3 class="mb-1">{{ ((stats.resolved / stats.totalAssigned) * 100).toFixed(0) }}%</h3>
                        <p class="mb-0">Completion Rate</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Row -->
        <div class="row">
            <!-- Recent Tasks -->
            <div class="col-lg-8 mb-4">
                <div class="card dashboard-card h-100">
                    <div class="card-header bg-white border-0 pb-0">
                        <div class="row align-items-center">
                            <div class="col">
                                <h5 class="mb-0"><i class="fas fa-list-alt text-primary"></i> Recent Tasks</h5>
                            </div>
                            <div class="col-auto">
                                <button class="btn btn-primary btn-sm action-btn" (click)="viewMyTasks()">
                                    View All Tasks
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body task-list">
                        <div *ngFor="let task of recentTasks; let i = index" 
                             class="task-item p-3 mb-3 border rounded cursor-pointer" 
                             [class.overdue-task]="isOverdue(task.dueDate)"
                             (click)="viewTaskDetails(task.complaintId)">
                            
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <div class="d-flex align-items-start">
                                        <div class="flex-grow-1">
                                            <h6 class="mb-1">{{ task.ticketNo }}</h6>
                                            <p class="text-muted mb-2">{{ task.description }}</p>
                                            <div class="d-flex gap-2">
                                                <span class="badge" [ngClass]="getPriorityClass(task.priority)">
                                                    {{ task.priority }}
                                                </span>
                                                <span class="badge" [ngClass]="getStatusClass(task.status)">
                                                    {{ task.status }}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 text-end">
                                    <small class="text-muted d-block">Due: {{ task.dueDate | date:'short' }}</small>
                                    <small class="d-block" 
                                           [ngClass]="isOverdue(task.dueDate) ? 'text-danger' : 
                                                     getDaysUntilDue(task.dueDate) <= 2 ? 'text-warning' : 'text-success'">
                                        <i class="fas fa-calendar-alt"></i>
                                        {{ getDaysUntilDue(task.dueDate) > 0 ? getDaysUntilDue(task.dueDate) + ' days left' : 'Overdue' }}
                                    </small>
                                </div>
                            </div>
                        </div>
                        
                        <div *ngIf="recentTasks.length === 0" class="text-center py-4">
                            <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                            <p class="text-muted">No tasks assigned yet.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Priority Distribution and Quick Stats -->
            <div class="col-lg-4">
                <!-- Priority Distribution -->
                <div class="card dashboard-card mb-4">
                    <div class="card-header bg-white border-0">
                        <h5 class="mb-0"><i class="fas fa-chart-pie text-warning"></i> Task Priority</h5>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-4">
                                <div class="priority-high">
                                    <i class="fas fa-exclamation-triangle fa-2x mb-2"></i>
                                    <h4>{{ taskPriority.high }}</h4>
                                    <small>High</small>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="priority-medium">
                                    <i class="fas fa-exclamation-circle fa-2x mb-2"></i>
                                    <h4>{{ taskPriority.medium }}</h4>
                                    <small>Medium</small>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="priority-low">
                                    <i class="fas fa-info-circle fa-2x mb-2"></i>
                                    <h4>{{ taskPriority.low }}</h4>
                                    <small>Low</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Upcoming Deadlines -->
                <div class="card dashboard-card">
                    <div class="card-header bg-white border-0">
                        <h5 class="mb-0"><i class="fas fa-clock text-danger"></i> Upcoming Deadlines</h5>
                    </div>
                    <div class="card-body">
                        <div *ngFor="let task of upcomingDeadlines; let i = index" 
                             class="border-bottom py-2" >
                            <div *ngIf="i < 5" class="border-bottom py-2">
                                <div class="row align-items-center">
                                    <div class="col-8">
                                        <h6 class="mb-0">{{ task.ticketNo }}</h6>
                                        <small class="text-muted">{{ task.description | slice:0:30 }}...</small>
                                    </div>
                                    <div class="col-4 text-end">
                                        <small class="d-block" 
                                            [ngClass]="getDaysUntilDue(task.dueDate) <= 1 ? 'text-danger' : 
                                                        getDaysUntilDue(task.dueDate) <= 2 ? 'text-warning' : 'text-muted'">
                                            {{ getDaysUntilDue(task.dueDate) === 0 ? 'Today' : 
                                            getDaysUntilDue(task.dueDate) === 1 ? 'Tomorrow' : 
                                            getDaysUntilDue(task.dueDate) + ' days' }}
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div *ngIf="upcomingDeadlines.length === 0" class="text-center py-3">
                            <i class="fas fa-check-circle fa-2x text-success mb-2"></i>
                            <p class="text-muted mb-0">No upcoming deadlines!</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card dashboard-card">
                    <div class="card-header bg-white border-0 d-flex justify-content-center align-items-center">
                        <h5 class="mb-0"><i class="fas fa-bolt text-primary"></i> Quick Actions</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3 col-sm-6 mb-3">
                                <button class="btn btn-outline-primary w-100 action-btn d-flex align-items-center justify-content-center" (click)="viewMyTasks()">
                                    <i class="fas fa-list fa-lg me-2 d-block"></i>
                                    View All My Tasks
                                </button>
                            </div>
                            <div class="col-md-3 col-sm-6 mb-3">
                                <button class="btn btn-outline-success w-100 action-btn d-flex align-items-center justify-content-center" 
                                        (click)="router.navigate(['/worker/update-task'])" 
                                        [disabled]="stats.inProgress === 0">
                                    <i class="fas fa-edit fa-lg me-2 d-block"></i>
                                    Update Task Status
                                </button>
                            </div>
                            <div class="col-md-3 col-sm-6 mb-3">
                                <button class="btn btn-outline-warning w-100 action-btn d-flex align-items-center justify-content-center">
                                    <i class="fas fa-exclamation-triangle fa-lg me-2 d-block"></i>
                                    Report Issue
                                </button>
                            </div>
                            <div class="col-md-3 col-sm-6 mb-3">
                                <button class="btn btn-outline-info w-100 action-btn d-flex align-items-center justify-content-center">
                                    <i class="fas fa-chart-bar fa-lg me-2 d-block"></i>
                                    View Reports
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
