<div class="container my-4">

  <div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="mb-0"><i class="fas fa-users me-2"></i>Manage Users</h5>
    </div>

    <ul class="nav nav-tabs mt-2" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#officials" type="button" role="tab">
          Officials
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#workers" type="button" role="tab">
          Workers
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#users" type="button" role="tab">
          Citizens
        </button>
      </li>
    </ul>

    <div class="tab-content p-3">
      
      <div class="tab-pane fade show active" id="officials" role="tabpanel">
        <div class="d-flex justify-content-end mb-3">
          <button class="btn btn-primary ms-2" (click)="openOfficialModal()">+ Add New Official</button>
        </div>

        <div class="table-responsive">
          <table class="table table-hover table-striped align-middle">
            <thead class="table-light">
              <tr>
                <th class="text-center">#</th>
                <th class="text-center">Full Name</th>
                <th class="text-center">Email</th>
                <th class="text-center">Phone</th>
                <th class="text-center">Role</th>
                <th class="text-center">Created At</th>
                <th class="text-center">Active</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let official of officials; let i = index">
                <td class="text-center">{{ i + 1 }}</td>
                <td class="text-center">{{ official.fullName }}</td>
                <td class="text-center">{{ official.email }}</td>
                <td class="text-center">{{ official.phone }}</td>
                <td class="text-center">
                  <span class="badge bg-info">{{ getUserRole(official.role) }}</span>
                </td>
                <td class="text-center">{{ official.createdAt | date:'short' }}</td>
                <td class="text-center">
                  <span class="badge" [ngClass]="official.isActive ? 'bg-success' : 'bg-secondary'">
                    {{ official.isActive ? 'Yes' : 'No' }}
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <ng-template #noOfficials>
          <p class="text-center text-muted py-4">No officials found.</p>
        </ng-template>
      </div>

      <div class="tab-pane fade" id="workers" role="tabpanel">
        <div class="d-flex justify-content-end mb-3">
          <button class="btn btn-success" (click)="openWorkerModal()">+ Add New Worker</button>
        </div>

        <div class="table-responsive">
          <table class="table table-hover table-striped align-middle">
            <thead class="table-light">
              <tr>
                <th class="text-center">#</th>
                <th class="text-center">Full Name</th>
                <th class="text-center">Email</th>
                <th class="text-center">Phone</th>
                <th class="text-center">Assigned Complaints</th>
                <th class="text-center">Resolved Complaints</th>
                <th class="text-center">Pending Complaints</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let worker of workers; let i = index">
                <td class="text-center">{{ i + 1 }}</td>
                <td class="text-center">{{ worker.fullName }}</td>
                <td class="text-center">{{ worker.email }}</td>
                <td class="text-center">{{ worker.phone }}</td>
                <td class="text-center">{{ worker.totalAssignedComplaints }}</td>
                <td class="text-center">{{ worker.totalResolvedComplaints }}</td>
                <td class="text-center">{{ worker.totalPendingComplaints }}</td>
              </tr>
            </tbody>
          </table>
        </div>
        <ng-template #noWorkers>
          <p class="text-center text-muted py-4">No workers found.</p>
        </ng-template>
      </div>

      <div class="tab-pane fade" id="users" role="tabpanel">
        <div class="table-responsive">
          <table class="table table-hover table-striped align-middle">
            <thead class="table-light">
              <tr>
                <th class="text-center">#</th>
                <th class="text-center">Full Name</th>
                <th class="text-center">Email</th>
                <th class="text-center">Phone</th>
                <th class="text-center">Raised Complaints</th>
                <th class="text-center">Resolved Complaints</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let user of generalUsers; let i = index">
                <td class="text-center">{{ i + 1 }}</td>
                <td class="text-center">{{ user.fullName }}</td>
                <td class="text-center">{{ user.email }}</td>
                <td class="text-center">{{ user.phone }}</td>
                <td class="text-center">{{ user.totalComplaints }}</td>
                <td class="text-center">{{ user.totalResolvedComplaints }}</td>
              </tr>
            </tbody>
          </table>
        </div>
        <ng-template #noUsers>
          <p class="text-center text-muted py-4">No users found.</p>
        </ng-template>
      </div>

    </div>
  </div>

</div>


<!-- Add Worker Modal -->
<div class="modal fade" id="workerModal" tabindex="-1" aria-labelledby="workerModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-4 shadow">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title" id="workerModalLabel"><i class="fas fa-user-tie me-2"></i>Add New Worker</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="onAddWorker(registerForm)" #registerForm="ngForm" novalidate>
        <div class="mb-3">
          <label class="form-label fw-semibold"><i class="fa-solid fa-user"></i> Full Name</label>
          <input type="text" 
            name="fullName" 
            [(ngModel)]="newWorker.fullName"
            class="form-control form-control-lg"
            placeholder="Enter your full name"
            required 
            #fullName="ngModel">
          <div *ngIf="fullName.invalid && fullName.touched" class="text-danger">
            Full Name is required.
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label fw-semibold"><i class="fa-solid fa-envelope"></i> Email</label>
          <input type="email" name="email" [(ngModel)]="newWorker.email"
            class="form-control form-control-lg" placeholder="Enter your email"
            required email #email="ngModel">
          <div *ngIf="email.invalid && email.touched" class="text-danger">
            <div *ngIf="email.errors?.['required']">Email is required.</div>
            <div *ngIf="email.errors?.['email']">Invalid email format.</div>
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label fw-semibold"><i class="fa-solid fa-key"></i> Password</label>
          <input type="password" name="password" [(ngModel)]="newWorker.password"
            class="form-control form-control-lg" placeholder="Enter a strong password"
            required minlength="6" #password="ngModel">
          <div *ngIf="password.invalid && password.touched" class="text-danger">
            <div *ngIf="password.errors?.['required']">Password is required.</div>
            <div *ngIf="password.errors?.['minlength']">Password must be at least 6 characters.</div>
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label fw-semibold"><i class="fa-solid fa-lock"></i> Confirm Password</label>
          <input type="password" name="confirmPassword" [(ngModel)]="confirmPasswordWorker"
            class="form-control form-control-lg" placeholder="Re-enter password"
            required #confirmPasswordModel="ngModel">
          <div *ngIf="confirmPasswordModel.invalid && confirmPasswordModel.touched" class="text-danger">
            Confirm Password is required.
          </div>
          <div *ngIf="confirmPasswordWorker && newWorker.password !== confirmPasswordWorker && confirmPasswordModel.touched" class="text-danger">
            Passwords do not match.
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label fw-semibold"><i class="fa-solid fa-phone"></i> Phone</label>
          <input type="number" name="phone" [(ngModel)]="newWorker.phone"
            class="form-control form-control-lg" placeholder="Enter your phone number"
            required pattern="^[0-9]{10}$" #phone="ngModel">
          <div *ngIf="phone.invalid && phone.touched" class="text-danger">
            <div *ngIf="phone.errors?.['required']">Phone number is required.</div>
          </div>
        </div>

        <div class="mb-3" >
          <label class="form-label fw-semibold"><i class="fa-solid fa-building"></i> Department</label>
          <select name="departmentId" [(ngModel)]="newWorker.departmentId"
            class="form-select form-select-lg" required #departmentId="ngModel">
            <option [ngValue]="null">-- Select Department --</option>
            <option *ngFor="let dept of departments" [ngValue]="dept.departmentId">{{ dept.departmentName }}</option>
          </select>
          <div *ngIf="departmentId.invalid && departmentId.touched" class="text-danger">
            Please select a department.
          </div>
        </div>

        <button type="submit" class="btn btn-primary btn-lg w-100 fw-semibold mt-2"
          [disabled]="registerForm.invalid || newWorker.password !== confirmPasswordWorker">
          ðŸš€ Register worker
        </button>
      </form>
      </div>
    </div>
  </div>
</div>

<!-- Official Modal -->
<div class="modal fade" id="officialModal" tabindex="-1" aria-labelledby="officialModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-4 shadow">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="officialModalLabel"><i class="fas fa-user-shield me-2"></i>Add New Official</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="onAddOfficial(registerOfficialForm)" #registerOfficialForm="ngForm" >
        <div class="mb-3">
          <label class="form-label fw-semibold"><i class="fa-solid fa-user"></i> Full Name</label>
          <input type="text" 
            name="fullName" 
            [(ngModel)]="newOfficial.fullName"
            class="form-control form-control-lg"
            placeholder="Enter your full name"
            required 
            #officialFullName="ngModel">
          <div *ngIf="officialFullName.invalid && officialFullName.touched" class="text-danger">
            Full Name is required.
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label fw-semibold"><i class="fa-solid fa-envelope"></i> Email</label>
          <input type="email" name="email" [(ngModel)]="newOfficial.email"
            class="form-control form-control-lg" placeholder="Enter your email"
            required email #officialEmail="ngModel">
          <div *ngIf="officialEmail.invalid && officialEmail.touched" class="text-danger">
            <div *ngIf="officialEmail.errors?.['required']">Email is required.</div>
            <div *ngIf="officialEmail.errors?.['email']">Invalid email format.</div>
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label fw-semibold"><i class="fa-solid fa-key"></i> Password</label>
          <input type="password" name="password" [(ngModel)]="newOfficial.password"
            class="form-control form-control-lg" placeholder="Enter a strong password"
            required minlength="6" #officialPassword="ngModel">
          <div *ngIf="officialPassword.invalid && officialPassword.touched" class="text-danger">
            <div *ngIf="officialPassword.errors?.['required']">Password is required.</div>
            <div *ngIf="officialPassword.errors?.['minlength']">Password must be at least 6 characters.</div>
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label fw-semibold"><i class="fa-solid fa-lock"></i> Confirm Password</label>
          <input type="password" name="confirmPassword" [(ngModel)]="confirmPasswordOfficial"
            class="form-control form-control-lg" placeholder="Re-enter password"
            required #officialConfirmPasswordModel="ngModel">
          <div *ngIf="officialConfirmPasswordModel.invalid && officialConfirmPasswordModel.touched" class="text-danger">
            Confirm Password is required.
          </div>
          <div *ngIf="confirmPasswordOfficial && newOfficial.password !== confirmPasswordOfficial && officialConfirmPasswordModel.touched" class="text-danger">
            Passwords do not match.
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label fw-semibold"><i class="fa-solid fa-phone"></i> Phone</label>
          <input type="number" name="phone" [(ngModel)]="newOfficial.phone"
            class="form-control form-control-lg" placeholder="Enter your phone number"
            required pattern="^[0-9]{10}$" minlength="1000000000" maxlength="9999999999" #officialPhone="ngModel">
          <div *ngIf="officialPhone.invalid && officialPhone.touched" class="text-danger">
            <div *ngIf="officialPhone.errors?.['pattern']" class="text-danger">
              Phone number must be exactly 10 digits.
              <!-- (You entered: {{ officialPhone.errors?.['pattern'].actualValue }}) -->
            </div>
            <div *ngIf="officialPhone.errors?.['required']">Phone number is required.
            </div>
          </div>
        </div>

        <div class="mb-3" >
          <label class="form-label fw-semibold"><i class="fa-solid fa-building"></i> Department</label>
          <select name="departmentId" [(ngModel)]="newOfficial.departmentId"
            class="form-select form-select-lg" required #officialDepartmentId="ngModel">
            <option [ngValue]="null">-- Select Department --</option>
            <option *ngFor="let dept of departments" [ngValue]="dept.departmentId">{{ dept.departmentName }}</option>
          </select>
          <div *ngIf="officialDepartmentId.invalid && officialDepartmentId.touched" class="text-danger">
            Please select a department.
          </div>
        </div>

        <button type="submit" class="btn btn-primary btn-lg w-100 fw-semibold mt-2"
          [disabled]="registerOfficialForm.invalid || newOfficial.password !== confirmPasswordOfficial">
          ðŸš€ Register Official
        </button>
      </form>
      </div>
    </div>
  </div>
</div>