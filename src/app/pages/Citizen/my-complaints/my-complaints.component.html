<div class="container-fluid py-4" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; border-radius: 10px;">
  <div class="row justify-content-center">
    <div class="col-12">
      
      <!-- Header -->
      <div class="text-center mb-4">
        <h2 class="text-white fw-bold">
          <i class="fas fa-clipboard-list me-2"></i>
          My Complaints
        </h2>
        <p class="text-white-50">Track and manage your submitted complaints</p>
      </div>

      <!-- Status Filter Pills -->
      <div class="card shadow-lg border-0 mb-4" style="border-radius: 20px;">
        <div class="card-body p-4">
          <div class="d-flex flex-wrap gap-2 justify-content-center">
            <button 
              *ngFor="let status of statusOptions" 
              type="button"
              class="btn btn-outline-primary filter-pill"
              [class.active]="selectedStatus === status.value"
              (click)="onStatusFilter(status.value)">
              <i class="fas {{status.icon}} me-2"></i>
              {{ status.label }}
              <span *ngIf="status.value !== 'All'" class="badge bg-light text-dark ms-2">
                {{ getComplaintsCountByStatus(status.value) }}
              </span>
              <span *ngIf="status.value === 'All'" 
                    class="badge bg-light text-dark ms-2">
                {{ complaints.length }}
              </span>
            </button>
          </div>
        </div>
      </div>

      <!-- Loading State -->
      <div *ngIf="isLoading" class="text-center py-5">
        <div class="spinner-border text-white" style="width: 3rem; height: 3rem;"></div>
        <p class="text-white mt-3">Loading your complaints...</p>
      </div>

      <!-- No Complaints -->
      <div *ngIf="!isLoading && filteredComplaints.length === 0" class="text-center py-5">
        <div class="card shadow-lg border-0" style="border-radius: 20px;">
          <div class="card-body p-5">
            <i class="fas fa-inbox fa-5x text-muted mb-4"></i>
            <h4 class="text-muted">No complaints found</h4>
            <p class="text-muted">
              {{ selectedStatus === 'All' ? 'You haven\'t submitted any complaints yet.' : 'No complaints with ' + selectedStatus + ' status.' }}
            </p>
            <a routerLink="/citizen/complaint/new" class="btn btn-primary btn-lg">
              <i class="fas fa-plus me-2"></i>
              Create New Complaint
            </a>
          </div>
        </div>
      </div>

      <div *ngIf="!isLoading && filteredComplaints.length > 0" class="row">
        <div *ngFor="let complaint of filteredComplaints" class="col-12 col-lg-6 col-xl-4 mb-4">
          <div class="card shadow-lg border-0 h-100 complaint-card" style="border-radius: 20px;">
            <div class="card-header bg-transparent border-0 p-4">
              <div class="d-flex justify-content-between align-items-start">
                <div>
                  <h6 class="fw-bold text-primary mb-1">{{ complaint.ticketNo }}</h6>
                  <small class="text-muted">
                    <i class="fas fa-clock me-1"></i>
                    {{ getTimeAgo(complaint.createdAt) }}
                  </small>
                </div>
                <span [ngClass]="getStatusBadgeClass(complaint.currentStatus)" class="px-3 py-2">
                  <i class="fas {{complaint.statusInfo.icon}} me-1"></i>
                  {{ complaint.statusInfo.label }}
                </span>
              </div>
            </div>

            <div class="card-body p-4 pt-0">
              <div class="progress mb-3" style="height: 6px;">
                <div class="progress-bar bg-primary" 
                     [style.width.%]="getProgressPercentage(complaint.currentStatus, complaint)">
                </div>
              </div>
              
              <div class="mb-3">
                <div class="d-flex align-items-center mb-2">
                  <i class="fas fa-building text-primary me-2"></i>
                  <strong class="text-dark">{{ complaint.departmentName }}</strong>
                </div>
                <div class="d-flex align-items-center text-muted small">
                  <i class="fas fa-tags me-2"></i>
                  {{ complaint.categoryName }} - {{ complaint.subCategoryName }}
                </div>
              </div>

              <p class="text-muted mb-3" style="display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden;">
                <strong>Description: </strong>{{ complaint.description }}
              </p>

              <div *ngIf="complaint.addressText" class="mb-3">
                <div class="d-flex align-items-center text-muted small">
                  <i class="fas fa-map-marker-alt text-danger me-2"></i>
                  <span class="text-truncate">{{ complaint.addressText }}</span>
                </div>
              </div>

              <div *ngIf="complaint.assignedWorkerName" class="mb-3">
                <div class="d-flex align-items-center text-success small">
                  <i class="fas fa-user-tie me-2"></i>
                  Assigned to: <strong class="ms-1">{{ complaint.assignedWorkerName }}</strong>
                </div>
              </div>

              <div *ngIf="complaint.slaDueAt && complaint.currentStatus != ComplaintStatus.Closed" class="mb-3">
                <div class="d-flex align-items-center text-warning small">
                  <i class="fas fa-hourglass-half me-2"></i>
                  Due: {{ complaint.slaDueAt | date:'short' }}
                </div>
              </div>

              <div *ngIf="complaint.feedback" class="mb-3">
                <strong>Feedback:</strong>
                <div class="bg-light rounded p-3">
                  <div class="d-flex align-items-center mb-2">
                    <i class="fas fa-star text-warning me-1"></i>
                    <strong class="me-2">{{ complaint.feedback.rating }}/5</strong>
                    <span class="badge bg-success" *ngIf=" complaint.feedback.isSatisfied === true">Satisfied</span>
                    <span class="badge bg-warning" *ngIf="complaint.feedback.isSatisfied === false">Not Satisfied</span>
                  </div>
                  <small class="text-muted"> <span class="text-muted fw-semibold">Comment:</span> {{ complaint.feedback.comments }}</small>
                </div>
              </div>

              <div *ngIf="complaint.citizenAttachments?.length > 0" class="mb-3">
                <small class="text-muted d-block mb-2">
                  <i class="fas fa-paperclip me-1"></i>
                  {{ complaint.citizenAttachments.length }} citizen attachment(s)
                </small>
                <div class="d-flex flex-wrap gap-1">
                  <img *ngFor="let attachment of complaint.citizenAttachments.slice(0, 3)" 
                       [src]="attachment.imageUrl" 
                       class="rounded"
                       (click)="openAttachment(attachment.imageUrl)"
                       style="width: 100px; height: 80px; object-fit: cover;">
                  <div *ngIf="complaint.citizenAttachments.length > 3"
                       class="d-flex align-items-center justify-content-center rounded bg-light"
                       style="width: 100px; height: 80px;">
                    <small class="text-muted">+{{ complaint.citizenAttachments.length - 3 }}</small>
                  </div>
                </div>
              </div>

              <!--worker Attachments -->
              <div *ngIf="complaint.workerAttachments?.length > 0" class="mb-3">
                <small class="text-muted d-block mb-2">
                  <i class="fas fa-paperclip me-1"></i>
                  {{ complaint.workerAttachments.length }} worker attachment(s)
                </small>
                <div class="d-flex flex-wrap gap-1">
                  
                  <img *ngFor="let attachment of complaint.workerAttachments.slice(0, 3)" 
                       [src]="attachment.imageUrl" 
                       class="rounded"
                       (click)="openAttachment(attachment.imageUrl)"
                       style="width: 100px; height: 80px; object-fit: cover;">
                  <div *ngIf="complaint.workerAttachments.length > 3"
                       class="d-flex align-items-center justify-content-center rounded bg-light"
                       style="width: 100px; height: 80px;">
                    <small class="text-muted">+{{ complaint.workerAttachments.length - 3 }}</small>
                  </div>
                </div>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="card-footer bg-transparent border-0 p-4">
              <div class="d-flex gap-2 flex-wrap">
                <button class="btn btn-outline-primary btn-sm flex-fill" 
                        (click)="viewComplaintDetails(complaint)">
                  <i class="fas fa-eye me-1"></i>
                  View Details
                </button>
                <button *ngIf="canEditComplaint(complaint)" 
                        class="btn btn-outline-info btn-sm flex-fill"
                        (click)="editComplaint(complaint)">
                  <i class="fas fa-edit me-1"></i>
                  Edit Complaint
                </button>

                <button *ngIf="canDeleteComplaint(complaint)" 
                        class="btn btn-outline-danger btn-sm flex-fill"
                        (click)="deleteComplaint(complaint.complaintId)">
                  <i class="fas fa-trash me-1"></i>
                  Delete Complaint
                </button>

                <button *ngIf="canProvideFeedback(complaint)" 
                        class="btn btn-success btn-sm flex-fill"
                        (click)="openFeedbackModal(complaint)">
                  <i class="fas fa-thumbs-up me-1"></i>
                  Feedback
                </button>

                <button *ngIf="canReopenComplaint(complaint)" 
                        class="btn btn-warning btn-sm flex-fill"
                        (click)="reopenComplaint(complaint.complaintId)">
                  <i class="fas fa-redo me-1"></i>
                  Reopen
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>


<!-- edit Complaint Details Modal -->
<div class="modal fade" [class.show]="showEditComplaintDetailsModal" [style.display]="showEditComplaintDetailsModal ? 'block' : 'none'" tabindex="-1" *ngIf="showEditComplaintDetailsModal">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content" style="border-radius: 20px; border: none; overflow: hidden;">
      
      <!-- Header -->
      <div class="modal-header bg-primary text-white" style="border-radius: 20px 20px 0 0;">
        <h5 class="modal-title">
          <i class="fas fa-edit me-2"></i>
          Edit Complaint Details
        </h5>
        <button type="button" class="btn-close btn-close-white" (click)="closeEditComplaintModal()"></button>
      </div>
      
      <!-- Body with sliding panels -->
      <div class="modal-body p-0" *ngIf="selectedComplaintForEdit" style="position: relative; min-height: 500px;">
        
        <!-- Main Content Panel -->
        <div class="main-panel" 
            [class.slide-left]="showLocationPanel"
            style="padding: 2rem; transition: transform 0.3s ease-in-out; width: 100%; position: absolute; top: 0; left: 0; height: 100%; background: white; z-index: 1;">
          
          <h6 class="fw-bold text-primary mb-3">Ticket No: {{ selectedComplaintForEdit.ticketNo }}</h6>
          
          <!-- <p><strong>Status:</strong> {{ selectedComplaintForEdit.statusInfo.label }}</p> -->
           <div class="mb-4">
            <label class="form-label fw-semibold">
              <i class="fas fa-comment me-2 text-primary"></i>
              Status:
            </label>
            <input type="text" disabled="" class="form-control form-control-lg" [(ngModel)]="selectedComplaintForEdit.statusInfo.label" placeholder="Enter your complaint description">
          </div>
          
          <div class="row g-4 mb-4">
            <div class="col-md-4">
              <label for="departmentId" class="form-label fw-semibold">
                <i class="fas fa-building me-2 text-primary"></i>
                Department <span class="text-danger">*</span>
              </label>
              <select id="departmentId" 
                      name="departmentId" 
                      class="form-select form-select-lg" 
                      [(ngModel)]="selectedComplaintForEdit.departmentId" 
                      (change)="onDepartmentChangeForEdit()" 
                      required>
                <option selected disabled value="">--Select Department--</option>
                <option *ngFor="let dept of departments" [value]="dept.departmentId">
                  {{ dept.departmentName }}
                </option>
              </select>
              <div *ngIf="selectedComplaintForEdit.submitted && !selectedComplaintForEdit.departmentId" class="text-danger small mt-2">
                <i class="fas fa-exclamation-triangle me-1"></i>Please select a department.
              </div>
            </div>

            <div class="col-md-4">
              <label for="categoryId" class="form-label fw-semibold">
                <i class="fas fa-list me-2 text-primary"></i>
                Category <span class="text-danger">*</span>
              </label>
              <select id="categoryId" 
                      name="categoryId" 
                      class="form-select form-select-lg" 
                      [disabled]="!selectedComplaintForEdit.departmentId" 
                      [(ngModel)]="selectedComplaintForEdit.categoryId" 
                      (change)="onCategoryChangeForEdit()" 
                      required>
                <option selected disabled value="">--Select Category--</option>
                <option *ngFor="let cat of categories" [value]="cat.categoryId">
                  {{ cat.categoryName }}
                </option>
              </select>
              <div *ngIf="selectedComplaintForEdit.submitted && !selectedComplaintForEdit.categoryId" class="text-danger small mt-2">
                <i class="fas fa-exclamation-triangle me-1"></i>Please select a category.
              </div>
            </div>

            <div class="col-md-4">
              <label for="subCategoryId" class="form-label fw-semibold">
                <i class="fas fa-sitemap me-2 text-primary"></i>
                Sub-Category <span class="text-danger">*</span>
              </label>
              <select id="subCategoryId" 
                      name="subCategoryId" 
                      [disabled]="!selectedComplaintForEdit.categoryId"
                      class="form-select form-select-lg" 
                      [(ngModel)]="selectedComplaintForEdit.subCategoryId" 
                      required>
                <option selected disabled value="">--Select Sub-Category--</option>
                <option *ngFor="let sub of subCategories" [value]="sub.subCategoryId">
                  {{ sub.subCategoryName }}
                </option>
              </select>
              <div *ngIf="selectedComplaintForEdit.submitted && !selectedComplaintForEdit.subCategoryId" class="text-danger small mt-2">
                <i class="fas fa-exclamation-triangle me-1"></i>Please select a sub-category.
              </div>
            </div>
          </div>

          <div class="mb-4">
            <label class="form-label fw-semibold">
              <i class="fas fa-comment me-2 text-primary"></i>
              Description
            </label>
            <input type="text" class="form-control form-control-lg" [(ngModel)]="selectedComplaintForEdit.description" placeholder="Enter your complaint description">
          </div>

          <!-- Location Section -->
          <div class="mb-4">
            <label class="form-label fw-semibold">
              <i class="fas fa-map-marker-alt me-2 text-primary"></i>
              Location
            </label>
            <div class="d-flex align-items-center justify-content-between bg-light p-3 rounded">
              <div class="flex-grow-1">
                <p class="mb-1" *ngIf="selectedComplaintForEdit.addressText; else noLocation">
                  <strong>Address:</strong> {{ selectedComplaintForEdit.addressText }}
                </p>
                <ng-template #noLocation>
                  <p class="mb-1 text-muted">No location set</p>
                </ng-template>
                <small class="text-muted" *ngIf="selectedComplaintForEdit.latitude && selectedComplaintForEdit.longitude">
                  Coordinates: {{ selectedComplaintForEdit.latitude | number:'1.6-6' }}, {{ selectedComplaintForEdit.longitude | number:'1.6-6' }}
                </small>
              </div>
              <button type="button" 
                      class="btn btn-outline-primary" 
                      (click)="openLocationPanel()">
                <i class="fas fa-edit me-1"></i>
                Change Location
              </button>
            </div>
          </div>

          <div *ngIf="selectedComplaintForEdit.slaDueAt" class="mb-3">
            <strong>Due Date:</strong> {{ selectedComplaintForEdit.slaDueAt | date:'short' }}
          </div>
          
          <!-- Attachments -->
          <div class="mt-3">
            <strong>Attachments:</strong>
            <div class="mt-2 mb-4">
                <label for="attachments" class="form-label fw-semibold">
                  <i class="fas fa-camera me-2 text-primary"></i>
                  Add attachments
                </label>
                <input type="file"
                       id="attachments"
                       class="form-control form-control-lg"
                       (change)="onFileSelected($event)"
                       multiple
                       accept="image/*"
                       #fileInput>
                <div class="form-text">
                  <i class="fas fa-info-circle me-1"></i>
                  Maximum file size: 5MB per image. Supported formats: JPG, PNG, GIF
                </div>
              </div>
              <h6 class="fw-semibold mb-2" *ngIf="selectedComplaintForEdit.attachments.length > 0">
                <i class="fas fa-folder-open me-2"></i>
                Existing Attachments
              </h6>
              <div class="d-flex gap-3 align-items-center">
                <div class="d-flex flex-wrap gap-2 mt-2 attachment-images" *ngFor="let att of selectedComplaintForEdit.attachments">
                  <div class="position-relative mb-2">
                    <button type="button" class="btn btn-danger btn-sm position-absolute top-0 end-0 m-1"
                            (click)="openDeleteAttachmentModal(selectedComplaintForEdit.complaintId, att.attachmentId)"
                            style="padding: 4px 8px;">
                      <i class="fas fa-trash"></i>
                    </button>
                    <img  
                        [src]="att.imageUrl" 
                        class="rounded" 
                        style="width: 80px; height: 80px; object-fit: cover;"
                        (click)="openAttachment(att.imageUrl)">
                  </div>
                </div>
              </div>
          </div>
          <!-- Image Previews -->
          <div *ngIf="previewImages.length > 0" class="mb-4">
            <h6 class="fw-semibold mb-3">
              <i class="fas fa-images me-2"></i>
              Selected Images ({{ previewImages.length }})
            </h6>
            <div class="row g-3">
              <div *ngFor="let img of previewImages; let i = index" class="col-6 col-md-4 col-lg-3">
                <div class="position-relative">
                  <img [src]="img" 
                        class="img-fluid rounded shadow-sm" 
                        style="height: 120px; width: 100%; object-fit: cover;">
                  <button type="button"
                          class="btn btn-danger btn-sm position-absolute top-0 end-0 m-1"
                          (click)="removeImage(i)"
                          style="padding: 4px 8px;">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Location Panel (slides in from right) -->
        <div class="location-panel" 
            [class.slide-in]="showLocationPanel"
            style="padding: 2rem; transition: transform 0.3s ease-in-out; width: 100%; position: absolute; top: 0; right: -100%; height: 100%; background: white; z-index: 2; overflow-y: auto;">
          
          <!-- Location Panel Header -->
          <div class="d-flex align-items-center mb-4">
            <button type="button" 
                    class="btn btn-outline-secondary me-3" 
                    [disabled]="!showLocationPanel"
                    (click)="closeLocationPanel()">
              <i class="fas fa-arrow-left"></i>
            </button>
            <div>
              <h5 class="mb-1 fw-bold text-primary">
                <i class="fas fa-map-marker-alt me-2"></i>
                Edit Location
              </h5>
              <p class="mb-0 text-muted">Update the location of your complaint</p>
            </div>
          </div>

          <!-- Address Input -->
          <div class="mb-4">
            <label for="editAddressText" class="form-label fw-semibold">
              <i class="fas fa-home me-2 text-primary"></i>
              Address
            </label>
            <input id="editAddressText" 
                  name="editAddressText" 
                  [disabled]="!showLocationPanel" 
                  type="text"
                  class="form-control form-control-lg" 
                  [(ngModel)]="selectedComplaintForEdit.addressText" 
                  placeholder="Enter your address">
          </div>

          <!-- Location Buttons -->
          <div class="row g-3 mb-4">
            <div class="col-md-6">
              <button type="button" 
                      class="btn btn-outline-primary btn-lg w-100" 
                      (click)="toggleMapForEdit()"
                      [disabled]="isLoadingLocationEdit || !showLocationPanel">
                <i class="fas fa-map me-2"></i>
                {{ showMapEdit ? 'Hide Map' : 'Set Location on Map' }}
              </button>
            </div>
            <div class="col-md-6">
              <button type="button" 
                      class="btn btn-outline-success btn-lg w-100" 
                      (click)="useCurrentLocationForEdit()"
                      [disabled]="isLoadingLocationEdit || !showLocationPanel">
                <i class="fas fa-crosshairs me-2" 
                  [class.fa-spin]="isLoadingLocationEdit"></i>
                {{ isLoadingLocationEdit ? 'Detecting...' : 'Use My Location' }}
              </button>
            </div>
          </div>

          <!-- Location Info -->
          <div *ngIf="selectedComplaintForEdit.latitude && selectedComplaintForEdit.longitude" class="alert alert-success">
            <i class="fas fa-check-circle me-2"></i>
            <strong>Location Set:</strong> 
            Latitude: {{ selectedComplaintForEdit.latitude | number:'1.6-6' }}, 
            Longitude: {{ selectedComplaintForEdit.longitude | number:'1.6-6' }}
          </div>

          <!-- Error Display -->
          <div *ngIf="locationErrorEdit" class="alert alert-warning">
            <i class="fas fa-exclamation-triangle me-2"></i>
            {{ locationErrorEdit }}
          </div>

          <!-- Map Section -->
          <div *ngIf="showMapEdit" class="map-container mb-4">
            <div class="card shadow-sm">
              <div class="card-header bg-primary text-white">
                <h6 class="mb-0">
                  <i class="fas fa-map me-2"></i>
                  Select Location on Map
                </h6>
                <small>Click on the map or drag the marker to set location</small>
              </div>
              <div class="card-body p-0">
                <div #mapContainerEdit 
                    id="mapContainerEdit" 
                    style="height: 350px; width: 100%;">
                </div>
              </div>
            </div>
          </div>

          <!-- Location Panel Actions -->
          <div class="d-flex justify-content-between">
            <button type="button" 
                    class="btn btn-outline-secondary" 
                    [disabled]="!showLocationPanel"
                    (click)="closeLocationPanel()">
              Cancel
            </button>
            <button type="button" 
                    class="btn btn-success" 
                    [disabled]="!showLocationPanel || isSubmitting"
                    (click)="saveLocationChanges()">
              <i class="fas fa-save me-2"></i>
              Save Location
            </button>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div class="modal-footer border-0 p-4" 
          [style.display]="showLocationPanel ? 'none' : 'flex'">
        <button type="button" 
                class="btn btn-outline-secondary" 
                (click)="closeEditComplaintModal()">
          Cancel
        </button>
        <button type="button" 
                class="btn btn-success" 
                [disabled]="isSubmitting"
                (click)="saveComplaintChanges()">
          <i class="fas fa-save me-2"></i>
          Save Changes
        </button>
      </div>
    </div>
  </div>

  <!-- Delete Attachment Confirm Modal -->
  <div class="modal fade" [class.show]="showDeleteAttachmentModal" 
      [style.display]="showDeleteAttachmentModal ? 'block' : 'none'"
      tabindex="-1" *ngIf="showDeleteAttachmentModal">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content" style="border-radius: 20px; border: none;">
        
        <!-- Header -->
        <div class="modal-header bg-danger text-white" style="border-radius: 20px 20px 0 0;">
          <h5 class="modal-title">
            <i class="fas fa-trash-alt me-2"></i>
            Delete Attachment
          </h5>
          <button type="button" class="btn-close btn-close-white" (click)="closeDeleteAttachmentModal()"></button>
        </div>
        
        <!-- Body -->
        <div class="modal-body text-center p-4">
          <div class="mb-3">
            <i class="fas fa-exclamation-triangle text-danger" style="font-size: 3rem;"></i>
          </div>
          <h5 class="fw-bold text-danger mb-2">Are you sure?</h5>
          <p class="text-muted mb-0">
            Do you really want to delete this attachment?  
            This action <strong>cannot be undone</strong>.
          </p>
        </div>
        
        <!-- Footer -->
        <div class="modal-footer border-0 p-4 d-flex justify-content-between">
          <button type="button" class="btn btn-outline-secondary" (click)="closeDeleteAttachmentModal()">
            <i class="fas fa-times me-1"></i>
            Cancel
          </button>
          <button type="button" class="btn btn-danger" (click)="confirmDeleteAttachment()">
            <i class="fas fa-trash me-2"></i>
            Delete
          </button>
        </div>
        
      </div>
    </div>
  </div>
</div>


<!-- view complaint details modal -->
<div class="modal fade" 
     [class.show]="showComplaintDetailsModal" 
     [style.display]="showComplaintDetailsModal ? 'block' : 'none'"
     tabindex="-1" 
     *ngIf="showComplaintDetailsModal">
     <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content" style="border-radius: 20px; border: none;">
      
      <!-- Header -->
      <div class="modal-header bg-primary text-white" style="border-radius: 20px 20px 0 0;">
        <h5 class="modal-title">
          <i class="fas fa-eye me-2"></i>
          Complaint Details
        </h5>
        <button type="button" class="btn-close btn-close-white" (click)="closeComplaintDetailsModal()"></button>
      </div>

      <!-- Body -->
      <div class="modal-body p-4" *ngIf="selectedComplaintForDetails">
        <h6 class="fw-bold text-primary mb-3">Ticket No: {{ selectedComplaintForDetails.ticketNo }}</h6>
        
        <!-- Complaint Status Stepper -->
        <div class="complaint-stepper mb-4">
          <div class="step-container d-flex justify-content-between position-relative">
            <!-- Background line -->
            <div class="line-background" 
                [style.left.%]="statusSteps.length > 1 ? (100 / statusSteps.length) / 2 : 0"
                [style.right.%]="statusSteps.length > 1 ? (100 / statusSteps.length) / 2 : 0"
                [style.display]="statusSteps.length > 1 ? 'block' : 'none'">
            </div>
            
            <!-- Progress line -->
            <div class="line-progress" 
                [style.left.%]="statusSteps.length > 1 ? (100 / statusSteps.length) / 2 : 0"
                [style.width.%]="progressWidth"
                [style.display]="statusSteps.length > 1 ? 'block' : 'none'">
            </div>
            
            <div *ngFor="let step of statusSteps; let i = index" class="step text-center flex-fill">
              <!-- Circle -->
              <div class="circle" 
              [class.active]="i === activeStepIndex" 
              [class.completed]="i <= activeStepIndex"
              [ngClass]="{'bg-warning text-dark': step === ComplaintStatus.Reopened}">
              <i *ngIf="i < activeStepIndex" class="fas fa-check"></i>
                <i *ngIf="i === activeStepIndex && step === ComplaintStatus.Reopened" class="fas fa-redo"></i>
                <i *ngIf="i === activeStepIndex && step === ComplaintStatus.Rejected" class="fas fa-ban"></i>
                <i *ngIf="i === activeStepIndex && step === ComplaintStatus.Resolved" class="fas fa-check-circle"></i>
                <i *ngIf="i === activeStepIndex && step === ComplaintStatus.Closed" class="fas fa-times-circle"></i>
                <i *ngIf="i === activeStepIndex && step === ComplaintStatus.InProgress" class="fas fa-spinner"></i>
                <i *ngIf="i === activeStepIndex && step === ComplaintStatus.Assigned" class="fas fa-user-check"></i>
                <i *ngIf="i === activeStepIndex && step === ComplaintStatus.Pending" class="fas fa-clock"></i>
                <span *ngIf="i > activeStepIndex">{{ i + 1 }}</span>
              </div>
              
              <!-- Label -->
              <div class="label mt-2 small fw-bold" 
              [class.active-label]="i === activeStepIndex">
              {{ step }}
            </div>
          </div>
        </div>
      </div>
      
      <p><strong>Status:</strong> {{ selectedComplaintForDetails.statusInfo.label }}</p>
      <p><strong>Department:</strong> {{ selectedComplaintForDetails.departmentName }}</p>
      <p><strong>Category:</strong> {{ selectedComplaintForDetails.categoryName }} - {{ selectedComplaintForDetails.subCategoryName }}</p>
      <p><strong>Description:</strong> {{ selectedComplaintForDetails.description }}</p>
      
        <p *ngIf="selectedComplaintForDetails.addressText">
          <strong>Location:</strong> {{ selectedComplaintForDetails.addressText }}
        </p>

        <p *ngIf="selectedComplaintForDetails.assignedWorkerName">
          <strong>Assigned Worker:</strong> {{ selectedComplaintForDetails.assignedWorkerName }}
        </p>

        <p *ngIf="selectedComplaintForDetails.slaDueAt">
          <strong>Due Date:</strong> {{ selectedComplaintForDetails.slaDueAt | date:'short' }}
        </p>
        

        <div *ngIf="selectedComplaintForDetails.citizenAttachments?.length > 0" class="mb-3">
          <small class="text-muted d-block mb-2">
            <i class="fas fa-paperclip me-1"></i>
            {{ selectedComplaintForDetails.citizenAttachments.length }} citizen attachment(s)
          </small>
          <div class="d-flex flex-wrap gap-1">
            <img *ngFor="let attachment of selectedComplaintForDetails.citizenAttachments" 
                  [src]="attachment.imageUrl" 
                  class="rounded"
                  (click)="openAttachment(attachment.imageUrl)"
                  style="width: 100px; height: 80px; object-fit: cover;">
          </div>
        </div>

        <div *ngIf="selectedComplaintForDetails.workerAttachments?.length > 0" class="mb-3">
          <small class="text-muted d-block mb-2">
            <i class="fas fa-paperclip me-1"></i>
            {{ selectedComplaintForDetails.workerAttachments.length }} Worker attachment(s)
          </small>
          <div class="d-flex flex-wrap gap-1">
            <img *ngFor="let attachment of selectedComplaintForDetails.workerAttachments" 
                  [src]="attachment.imageUrl" 
                  class="rounded"
                  (click)="openAttachment(attachment.imageUrl)"
                  style="width: 100px; height: 80px; object-fit: cover;">
          </div>
        </div>
      </div>
      
      <div class="modal-footer border-0 p-4">
        <button type="button" class="btn btn-outline-secondary" (click)="closeComplaintDetailsModal()">
          Close
        </button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" [class.show]="showFeedbackModal" [style.display]="showFeedbackModal ? 'block' : 'none'"
     tabindex="-1" *ngIf="showFeedbackModal">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="border-radius: 20px; border: none;">
      <div class="modal-header bg-primary text-white" style="border-radius: 20px 20px 0 0;">
        <h5 class="modal-title">
          <i class="fas fa-star me-2"></i>
          Provide Feedback
        </h5>
        <button type="button" class="btn-close btn-close-white" (click)="closeFeedbackModal()"></button>
      </div>
      
      <div class="modal-body p-4">
        <div class="mb-4">
          <h6 class="fw-bold">Ticket: {{ selectedComplaintForFeedback?.ticketNo }}</h6>
          <p class="text-muted small">{{ selectedComplaintForFeedback?.description }}</p>
        </div>

        <div class="mb-4">
          <label class="form-label fw-semibold">
            <i class="fas fa-question-circle me-2 text-primary"></i>
            Are you satisfied with the resolution?
          </label>
          <div class="btn-group d-block" role="group">
            <input type="radio" class="btn-check" name="satisfaction" id="satisfied" 
                   [(ngModel)]="feedbackData.isSatisfied" [value]="true">
            <label class="btn btn-outline-success me-2" for="satisfied">
              <i class="fas fa-thumbs-up me-1"></i>
              Yes, Satisfied
            </label>

            <input type="radio" class="btn-check" name="satisfaction" id="notSatisfied" 
                   [(ngModel)]="feedbackData.isSatisfied" [value]="false">
            <label class="btn btn-outline-danger" for="notSatisfied">
              <i class="fas fa-thumbs-down me-1"></i>
              No, Not Satisfied
            </label>
          </div>
          <small class="form-text text-muted">
            *If not satisfied, the complaint will be reopened automatically
          </small>
        </div>

        <div class="mb-4">
          <label class="form-label fw-semibold">
            <i class="fas fa-star me-2 text-warning"></i>
            Rate the service (1-5 stars)
          </label>
          <div class="rating-container">
            <button *ngFor="let star of [1,2,3,4,5]" 
                    type="button"
                    class="btn p-1"
                    [class.text-warning]="star <= feedbackData.rating"
                    [class.text-muted]="star > feedbackData.rating"
                    (click)="setRating(star)">
              <i class="fas fa-star fa-2x"></i>
            </button>
          </div>
          <small class="form-text text-muted">Current rating: {{ feedbackData.rating }}/5</small>
        </div>

        <div class="mb-3">
          <label class="form-label fw-semibold">
            <i class="fas fa-comment me-2 text-primary"></i>
            Additional Comments
          </label>
          <textarea class="form-control" 
                    rows="4" 
                    [(ngModel)]="feedbackData.comments"
                    placeholder="Share your experience or suggestions for improvement...">
          </textarea>
        </div>
      </div>

      <div class="modal-footer border-0 p-4">
        <button type="button" class="btn btn-outline-secondary" (click)="closeFeedbackModal()">
          Cancel
        </button>
        <button type="button" class="btn btn-primary" (click)="submitFeedback()">
          <i class="fas fa-paper-plane me-2"></i>
          Submit Feedback
        </button>
      </div>
    </div>
  </div>
</div>


<!--Confirm delete Modal-->
<div class="modal fade" [class.show]="showDeleteModal" [style.display]="showDeleteModal ? 'block' : 'none'"
     tabindex="-1" *ngIf="showDeleteModal">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="border-radius: 20px; border: none;">
      
      <div class="modal-header bg-danger text-white" style="border-radius: 20px 20px 0 0;">
        <h5 class="modal-title">
          <i class="fas fa-trash-alt me-2"></i>
          Confirm Delete
        </h5>
        <button type="button" class="btn-close btn-close-white" (click)="closeDeleteModal()"></button>
      </div>
      
      <div class="modal-body text-center p-4">
        <div class="mb-3">
          <i class="fas fa-exclamation-triangle text-danger" style="font-size: 3rem;"></i>
        </div>
        <h5 class="fw-bold text-danger mb-2">Are you sure?</h5>
        <p class="text-muted mb-0">
          This action <strong>cannot be undone</strong>.  
          Do you really want to delete this item?
        </p>
      </div>
      
      <div class="modal-footer border-0 p-4 d-flex justify-content-between">
        <button type="button" class="btn btn-outline-secondary" (click)="closeDeleteModal()">
          <i class="fas fa-times me-1"></i>
          Cancel
        </button>
        <button type="button" class="btn btn-danger" (click)="confirmDeleteComplaint()">
          <i class="fas fa-trash me-2"></i>
          Delete
        </button>
      </div>      
    </div>
  </div>
</div>


<!-- Modal Backdrop -->
<div class="modal-backdrop fade" [class.show]="showComplaintDetailsModal" *ngIf="showComplaintDetailsModal"></div>

<!-- Modal  Backdrop -->
<div class="modal-backdrop fade" [class.show]="showComplaintDetailsModal" *ngIf="showComplaintDetailsModal"></div>

<!-- Modal Backdrop for view component details -->
<div class="modal-backdrop fade" [class.show]="showComplaintDetailsModal" *ngIf="showComplaintDetailsModal"></div>


<!-- Modal Backdrop for show feedback modal-->
<div class="modal-backdrop fade" [class.show]="showFeedbackModal" *ngIf="showFeedbackModal"></div>

